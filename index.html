<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0a0a0f">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ãƒœãƒ¼ãƒ€ãƒ¼è¨ˆç®—æ©Ÿ">
<link rel="manifest" id="pwa-manifest">
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAADqklEQVR42u3dQUEEMRBFwZz3gg20oBI5SMEFeIBJ0t2/Dk8As7+S2QOwXq+3Hym15SEIAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAmApL4+37fnOQMQM3YoADB4IAAwehgAMHoYADB8EAAwfBAAMHwQADB8EAAwfBAAMHwQAKg2/u+vj38HAQDlh//E0KvDAMD4rw6+AggAgodfcfS3MAAQNP5Owz8JAYDB4+88+pMYADB8EBpDWMafM/zdEABoOP7E4e+EAIDxQwBA7fEb/H4IABg/BADUGb9h34EAgPFDAIDxQwDA0fEbbj0IABwCYKw1EQBg/BAAYPwQAGD8EADwFABj7IcAAOOHAADjhwAAAADIBWD8EMQCMH4IbiNoB8DIZiKIA+D0B6ACguX0V/ItsIxfyQgAEADGr1QE5QEYUR6CsQCc/gBUQ7Cc/kq+BZbTX8m3wHL6K/kWWE5/Jd8Cy+mv5FsAAAHg9Uepr0HL6a/kWwAAAWD8SkUAgAAAQABcBmAUEIwC4PRXh1sAAAEAgADw/q/A7wEACACvP0p9DQJAAAAgAAAQAL4AK+uLMAACAAABAIAAAEAAACAAABAAAAgAAAQAAAIAAAEAgAAAQAAAIAAAEAAACAAABIDfCJPfCANAAAAgAABQIABfhOVPIwIgACCQvw4NgAAAQFEAfA9Q9fd//yVS0ac/AAIAAAEAgQLHD4AAqAYAAuMfBcAtoKqnPwACoCIACIx/FAC3gCqe/qUBQOD0HwXALQBAtfGXBwCB038UALcAAJXG3wIABE7/UQAgMP4q4wdAANwAAIHxVxh/OwAQzB1/HAC3AAC3x98SAARO/zEAIDD+m+MvAQAC4wcAAACSAUBg/PEAIDB+AP74MCHoNX4AIDB+ACAwfgAgMH4AngYAQb3xA3ABAQg1hl91/OUBQGD88QAgMP54AE8hAOHc8DuMvxUACIw/HsCTCEDYM/xO428JAALjjwfwNIJUCE8/w447agtgB4IUCDueW9cNtQYAguEDsBHBBAw7n8uE3YwBsBtBNwi7n8WUzYwCcApCVQwnfu5pWxkJ4BSC2yBO/4wTdzIWwC0IO2Dc/hkm72M8gAoIOjd9GxEAQDB8AEAwfABAMHwAQDB8ANIh+LwBiITg8wUgDoPPEYA4DD4vAKJA+DwAiEHhOQMgASABIAEgASABIAEgASABIAEgASABIAEgASABIAA8BAEgASABIAEgpfQLA6pUi6zYGFYAAAAASUVORK5CYII=">
<script>
// Inline manifest (no separate file needed)
const manifestData = {
  "name": "ãƒ‘ãƒãƒ³ã‚³ ãƒœãƒ¼ãƒ€ãƒ¼è¨ˆç®—æ©Ÿ",
  "short_name": "ãƒœãƒ¼ãƒ€ãƒ¼è¨ˆç®—æ©Ÿ",
  "description": "ãƒ‘ãƒãƒ³ã‚³ã®ãƒœãƒ¼ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³ã‚’AIã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ãƒ»è¨ˆç®—",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#0a0a0f",
  "theme_color": "#0a0a0f",
  "orientation": "portrait",
  "lang": "ja",
  "icons": [
    {"src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAADqklEQVR42u3dQUEEMRBFwZz3gg20oBI5SMEFeIBJ0t2/Dk8As7+S2QOwXq+3Hym15SEIAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAmApL4+37fnOQMQM3YoADB4IAAwehgAMHoYADB8EAAwfBAAMHwQADB8EAAwfBAAMHwQAKg2/u+vj38HAQDlh//E0KvDAMD4rw6+AggAgodfcfS3MAAQNP5Owz8JAYDB4+88+pMYADB8EBpDWMafM/zdEABoOP7E4e+EAIDxQwBA7fEb/H4IABg/BADUGb9h34EAgPFDAIDxQwDA0fEbbj0IABwCYKw1EQBg/BAAYPwQAGD8EADwFABj7IcAAOOHAADjhwAAAADIBWD8EMQCMH4IbiNoB8DIZiKIA+D0B6ACguX0V/ItsIxfyQgAEADGr1QE5QEYUR6CsQCc/gBUQ7Cc/kq+BZbTX8m3wHL6K/kWWE5/Jd8Cy+mv5FsAAAHg9Uepr0HL6a/kWwAAAWD8SkUAgAAAQABcBmAUEIwC4PRXh1sAAAEAgADw/q/A7wEACACvP0p9DQJAAAAgAAAQAL4AK+uLMAACAAABAIAAAEAAACAAABAAAAgAAAQAAAIAAAEAgAAAQAAAIAAAEAAACAAABIDfCJPfCANAAAAgAABQIABfhOVPIwIgACCQvw4NgAAAQFEAfA9Q9fd//yVS0ac/AAIAAAEAgQLHD4AAqAYAAuMfBcAtoKqnPwACoCIACIx/FAC3gCqe/qUBQOD0HwXALQBAtfGXBwCB038UALcAAJXG3wIABE7/UQAgMP4q4wdAANwAAIHxVxh/OwAQzB1/HAC3AAC3x98SAARO/zEAIDD+m+MvAQAC4wcAAACSAUBg/PEAIDB+AP74MCHoNX4AIDB+ACAwfgAgMH4AngYAQb3xA3ABAQg1hl91/OUBQGD88QAgMP54AE8hAOHc8DuMvxUACIw/HsCTCEDYM/xO428JAALjjwfwNIJUCE8/w447agtgB4IUCDueW9cNtQYAguEDsBHBBAw7n8uE3YwBsBtBNwi7n8WUzYwCcApCVQwnfu5pWxkJ4BSC2yBO/4wTdzIWwC0IO2Dc/hkm72M8gAoIOjd9GxEAQDB8AEAwfABAMHwAQDB8ANIh+LwBiITg8wUgDoPPEYA4DD4vAKJA+DwAiEHhOQMgASABIAEgASABIAEgASABIAEgASABIAEgASABIAA8BAEgASABIAEgpfQLA6pUi6zYGFYAAAAASUVORK5CYII=", "sizes": "192x192", "type": "image/png", "purpose": "any maskable"},
    {"src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAANv0lEQVR42u3cwY3CUBBEQZ99cRrEQpSE41CcBUSBNNNdh0qA1brf/0Yc53l9AYAuhw8BAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAACAAgA3uz2s8fycQAEDgwAsEEACAoRcGIAAAQy8MQACAwUcQgAAAY48oAAEARh8xAAIADD6CAAQAGH3EAAgAMPgIAhAAYPQRAyAAwPAjBEAAgNFHDIAAwOiDGAABgOEHIQACAKMPYgABAIYfhAACAAw/CAEEABh+EAIIADD6IAYQAGD4QQggAMDwgxBAAIDhByGAAADjDyIAAYDhByEAAgDDD0IABACGH4QACAAMPwgBEAAYfxABIAAw/CAEQABg+As99/tvfL5CAAEAxj9o2IWCCEAAgOE38uJACCAAwPgbemEgAhAAYPgNviAQAggAjD8GXxCIAAQAht/gIwiEAAIA42/wEQQiAAGA8Tf6iAERgADA8Bt9xIAQQABg/I0+YkAEIAAw/oYfISACEAAYfqOPGBACCACMv+FHCIgABADG3+gjBkQAAgDDb/gRAkIAAUDt+BswhIAIQABQNP4GCyEgAhAAFI2/gUIIiAAEAEXjb5AQAiIAAUDR+BsghIAIQABg+EEICAEEAInjb2AQAiIAAYDxBxEgAhAApI6/IUEIiAAEAEXjbzgQAiIAAYDxBxEgAhAApI6/gUAIiAAEAEXjbxAQAiIAAYDxBxEgAhAApI6/Bz/khIDnsQDA+Bt/EAEIAIy/8QcRgACgevw92KEjBDynBQDG3/iDCEAAYPwBEYAAIH78PbhBCHh+CwCMPyACEAAkB4CHNIgAASAAKBp/D2YQAiJAAGD8AREgAgQAxh8QASJAAGD8ARGAAMD4AyIAAWD8jT8gAhAAAsD4A4kR4LkvAFgy/h6sIAREgADA+AMiQAQIAIw/IAJEgAAgJgA8PEEECAABgPEHRIAIEAAYf0AEiAABgPEHRIAIEADsDAAPRxABAkAAYPwBESACBADGHxABIkAA4L0/IABEgADA6R8QAQJAAGD8AREgAgSA8Tf+gAgQAQJAABh/QAQIAAFg/I0/IAJEgAAw/sYfEAEiQAAIAOMPiAABIACMvwAA3AIgAIy/8QdEAAJAABh/wKsABIDx9/ACRAACQAAACAAEgPEHEAECAOMPIAIEAHsDwEMKaIoAOyQAjL8AANwCIACc/gHcAiAAjD+ACEAApAWAhxHQHgF2SQA4/QO4BUAAOP0DuAVAABh/ABGAAHD1D+BVgADA6R/ALYAAwOkfwC2AABAAxh/ALYAAMP7GH0AECAABIAAABIAAMP7GHxABIkAACAABAAgAASAABIDxB0SAABAAxt/4AyJABAgAASAAAAEgAASA8fcQAUSACBAAAgBAAAgAAWD8AUSACBAAAgBAAAgAAWD8AUSACBAAAgBAANg5ATA4ADwsABEgAASA0z+AABABAsDpH0AECAAB4PQPIABEgABw+gcQAQJAAAgAAAEgAASA8QcQASJAAAgAAAEgAASA8QdoigABYPwFAIBbAAEgAAQAgAAQAMbf+AOIAAEgAAQAgAAQAALA+AP4MqAAMP4CAMAtgAAQAAIAQAAIAAFg/AG8BhAAAgAAASAAjD+ACBABAkAAAAgAASAABACAABAAAsD4A4gAESAABACAABAAAkAAAAgAASAA5gSAf26A2REgAIy/AABwCyAABIAAABAAAkAAGH8ArwEEgPEXAABuAQSAABAAAAJAAAgAAQAgAASA9/8A+B6AABAAAAgAAeD6HwCvAQSAAAAQAAJAALj+BxABAkAACAAAASAABIDrfwABIAIEgAAAEAACQAAYfwARIAAEgAAAEAACQAAIAAABIAAEgAAAEAACwPgbfwARIAAEgAAAEAACQAAIAAABIAAEgAAAEAACQAAAIAAEgAAAQAAIAOMPgAgQAAIAAAEgAAQAAAJAAAgAAAEgAASAAAAQAAJAAAgAAAEgAASAAAAQAAJAABh/ABEgAAoCwOkfQACIAAEgAAAEgAAQAAIAQAAIAAEgAAAEgAAQAAIAQAAIAAEgAAAEgAAQAAIAQAAIAAEgAAAEgAAQAAIAQAAIAL8CCIBfAxQAAgAAASAABAAAAkAACAAABIAAEAAACAABIAAAEAACQAAACAABIAAEAIAAEAACQAAACAABIAAEAIAAEAACQAAACAABIAAEAIAAEAACQAAACAABIAAEAIAAEAACQAAACAABIAAEAIAAEAACQAAACAABIAAAEAACQAAAIAAEgAAAQAAIAAEAgAAQAAIAAAEgAAQAAAJAAEwOABEAkDn+AkAACAAAASAABIAAABAAAkAACAAAASAABAAAAkAACAAABIAAEAAACAABIAAAEAACQAAAIAAEgF8DBMCvAAoAtwAAxl8ACAABACAABIAAEAAAAkAACAABACAABIAAEAAAAkAACAABACAABIAAEAAAAkAAiAARAGD8QzdSAAgAAAEgAASAAAAQAAJAAAgAAAEgAASAAAAQAAJAAAgAAAEgAESACAAw/gJAAPjHBRAAAkAAACAABIAAAEAACIDMABABAHvHXwAIAAEAIAAEgAgQAACu/wWAABAAAAJAAAgAEQDg+l8ACAABACAABIDXAAC4/hcAAgAAASAAvAYAwPW/ABAAAAJAAAgAAQAgAASAAPA9AAABYPwFgFsAAOMvAASAAAAQAAJAAHgNACAAjL8AEAEAxl8ACAABACAABIAAEAAAAkAAiAARAGD8BYAAEAAAAkAACAABACAABIAIEAEAxl8ACAABACAABIAAEAEAA8dfAAgAAQAgAASACBAAAK7/BYAAEAEATv8CQAAIAAABIABEgAgAMP4CQAAIAAABIABEgAAA8OU/ASAARABg/J3+BYAAEACAABAAAkAEABh/4y8ABACAABAAAiA7AEQAYPwFgABwCwAgAIy/AHALAGD8BYAAcAsAIACMvwBwCwBg/AWAABAAAAJAAAgAEQBg/O2bABAAAAJAAPgQRACA8RcACAAAASAARIAIADD+AkAACAAAASAARIAIADD+AkAAiACAUc9NOyYABACAAEAAiAAA4y8AfBACAEAACABEAIDxFwCMCwARABh/ASAA3AIACADjLwDcAgA4/SMA3AIAOP0jAEQAgPFHAHgVAODqXwDgFgDA6V8A4BYAwOlfACACAIy/AGBgAIgAoG38BYAAEAECAHD6RwC4BQBw+kcAiAAA448AEAEAxl8A+BAEAIAAEACIAADjLwBYHgAiAEgafwEgAESACACMPwJABAgAwNU/AkAAiADA6R8BIAJEAGD8EQAiwEMOMP4CwIfQFwAiANgy/gJAAIgAEQAYfwSACBABgPFHAAgAEQBEjb8AEAAiQAAATv8IABEgAgDjjwAQASIAMP4IAAEgAgDv/REAIkAEAMYfASACRAAYf+OPABABIgCMv/EXAAgAEQDGXwAIAESACADjb/wFACLAwxSMv/EXAJRGgBAAw2/8BQClASACwPgLAAGACACMv/EXAIgAwPgbfwGACACMv/EXAIgAwPgjABABgPFHAJAQAUIADL/xFwCUBoAIAOMvAAQAIgAw/ggA2iJACEDn8Bt/AYAIEAFg/BEAiADA+CMAqIsAIQC5w2/8BQAiQASA8UcAIAJEABh/BAAiQAhAzPAbfwGACBABYPwRAIgAIQDJw2/8BQAiQAhA2fAbfwGACBABYPwRAIgAIQDJw2/8BQAiQAhA2fAbfwGACBABYPwRAIgAIQDJw2/8BQBCQAiA4UcAIAKEAKQOv/EXAIgAIQBlw2/8BQAiQAhA2fAbfwGACBACUDb8xl8AIAKEAJQNv/EXAAgBIQCGHwGACBADGH3jjwBABAgBDL/xRwAgBMQARt/wIwAQAUIAw2/8EQCIADGA0Tf+CACEgBjA6Bt+BAAiQAxg9I0/AgARIAgw+MYfAYAQEAQYfMOPAEAECAKDj/FHACAEBIHBx/AjABABwsDQG38QAAgBcWDkDT8IAESAUDDsxh8EAEIADD8IAIQAGH4EAIgAMP4IABACYPgRACAEwPAjAEAIgOFHAIAQAMOPAAARAMYfAQBCAAw/AgCEAIYfBAAIAQw/CAAQAxh9EAAgBDD8IABACGD4QQCAEMDwgwAAMYDRBwGAEDBUGH4QAIgBMPogABADYPQRAD4EhAD4v0AAgBjA6IMAAEGAwQcBAGIAow8CAAQBBh8EAIgBjD4IABAFGHsQACAIMPggAEAYYOhBAACXoQcEALAzEPydQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAEAAAgAAAAAQAACAAAQAAAAAIAAJjuBx2iOstVt+m5AAAAAElFTkSuQmCC", "sizes": "512x512", "type": "image/png", "purpose": "any maskable"}
  ]
};
const blob = new Blob([JSON.stringify(manifestData)], {type:'application/json'});
document.getElementById('pwa-manifest').href = URL.createObjectURL(blob);

// Register service worker inline via blob
const swCode = `
const CACHE = 'pachi-v1';
self.addEventListener('install', e => {
  e.waitUntil(caches.open(CACHE).then(c => c.addAll(['/'])));
  self.skipWaiting();
});
self.addEventListener('fetch', e => {
  // Network first for API calls, cache first for app shell
  if (e.request.url.includes('fonts.googleapis')) {
    e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
  } else {
    e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
  }
});
`;
if ('serviceWorker' in navigator) {
  const swBlob = new Blob([swCode], {type:'text/javascript'});
  const swUrl = URL.createObjectURL(swBlob);
  navigator.serviceWorker.register(swUrl).catch(()=>{});
}
</script>
<title>ãƒœãƒ¼ãƒ€ãƒ¼è¨ˆç®—æ©Ÿ</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@300;400;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --panel: #10101a;
  --panel2: #141420;
  --gold: #e8c84a;
  --gold2: #c9a82a;
  --cyan: #3af0e0;
  --red: #ff3b5c;
  --green: #2ef08a;
  --dim: #3a3a55;
  --muted: #606088;
  --text: #dde0f0;
  --border: #1e1e32;
  --fav: #ff9a00;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }

body {
  background:var(--bg);
  color:var(--text);
  font-family:'Noto Sans JP',sans-serif;
  min-height:100vh;
}
body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 80% 50% at 50% -10%, rgba(232,200,74,.06) 0%, transparent 70%),
    repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(255,255,255,.012) 40px),
    repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(255,255,255,.012) 40px);
}

.wrap {
  position:relative; z-index:1;
  max-width:660px; margin:0 auto;
  padding:2.5rem 1.2rem 5rem;
}

/* â”€â”€ Header â”€â”€ */
.hdr { text-align:center; margin-bottom:2.2rem; }
.hdr-sub {
  font-size:.6rem; letter-spacing:.5em; text-transform:uppercase;
  color:var(--gold); margin-bottom:.5rem;
  text-shadow:0 0 16px rgba(232,200,74,.5);
}
.hdr h1 {
  font-family:'Bebas Neue',sans-serif;
  font-size:clamp(2.4rem,8vw,4rem);
  letter-spacing:.08em; color:#fff; line-height:1;
  text-shadow:0 0 40px rgba(232,200,74,.3), 0 2px 0 rgba(0,0,0,.8);
  margin-bottom:.5rem;
}
.hdr h1 span { color:var(--gold); }
.hdr-tags { display:flex; justify-content:center; gap:.5rem; flex-wrap:wrap; }
.tag {
  font-size:.62rem; padding:.2rem .65rem;
  border-radius:3px; letter-spacing:.05em;
  border:1px solid; background:rgba(255,255,255,.03);
}
.tag.gold { color:var(--gold); border-color:rgba(232,200,74,.3); }
.tag.cyan { color:var(--cyan); border-color:rgba(58,240,224,.3); }
.tag.fav  { color:var(--fav); border-color:rgba(255,154,0,.3); }
hr.rule {
  border:none; height:1px; margin:1.8rem 0;
  background:linear-gradient(90deg, transparent, var(--gold) 20%, var(--cyan) 80%, transparent);
  opacity:.35;
}

/* â”€â”€ Card â”€â”€ */
.card {
  background:var(--panel);
  border:1px solid var(--border);
  border-top:2px solid transparent;
  border-radius:8px; padding:1.8rem; margin-bottom:1rem;
  position:relative; overflow:visible;
  background-image:linear-gradient(var(--panel), var(--panel)),
                   linear-gradient(90deg, var(--gold2), var(--gold), var(--cyan));
  background-origin:border-box;
  background-clip:padding-box, border-box;
}
.card-label {
  font-size:.58rem; letter-spacing:.3em; text-transform:uppercase;
  color:var(--gold); margin-bottom:1.4rem; opacity:.8;
}

/* â”€â”€ Favorites section â”€â”€ */
.fav-section { margin-bottom:1rem; }
.fav-title {
  font-size:.6rem; color:var(--fav); letter-spacing:.15em;
  margin-bottom:.55rem; display:flex; align-items:center; gap:.4rem;
  text-transform:uppercase;
}
.fav-list { display:flex; flex-direction:column; gap:.35rem; }
.fav-item {
  display:flex; align-items:center; gap:.6rem;
  background:rgba(255,154,0,.06); border:1px solid rgba(255,154,0,.18);
  border-radius:6px; padding:.55rem .8rem;
  cursor:pointer; transition:background .12s;
}
.fav-item:hover { background:rgba(255,154,0,.13); }
.fav-star { color:var(--fav); font-size:.95rem; flex-shrink:0; }
.fav-name { flex:1; font-size:.85rem; line-height:1.3; }
.fav-bdr {
  font-family:'Bebas Neue',sans-serif; font-size:1rem;
  color:var(--gold); letter-spacing:.05em; white-space:nowrap;
  margin-right:.2rem;
}
.fav-bdr em { font-family:'Noto Sans JP'; font-style:normal; font-size:.6rem; color:var(--muted); }
.fav-del {
  background:none; border:none; color:var(--dim);
  cursor:pointer; font-size:.85rem; padding:.15rem .3rem;
  border-radius:3px; transition:color .12s, background .12s;
  flex-shrink:0; line-height:1;
}
.fav-del:hover { color:var(--red); background:rgba(255,59,92,.1); }
.fav-divider { height:1px; background:rgba(255,255,255,.06); margin:1rem 0; }

/* â”€â”€ Search â”€â”€ */
.search-block { position:relative; }
.search-row { display:flex; gap:.6rem; align-items:stretch; }
.machine-input {
  flex:1; background:rgba(0,0,0,.5);
  border:1px solid var(--dim); border-radius:6px;
  color:var(--text); font-family:'Noto Sans JP',sans-serif;
  font-size:1rem; padding:.75rem 1rem;
  outline:none; transition:border-color .15s, box-shadow .15s;
}
.machine-input::placeholder { color:#282840; }
.machine-input:focus { border-color:var(--gold); box-shadow:0 0 16px rgba(232,200,74,.1); }
.machine-input.searching { border-color:var(--cyan); }
.machine-input.found { border-color:var(--green); }
.machine-input.error { border-color:var(--red); }
.search-btn {
  padding:.75rem 1.2rem; border-radius:6px;
  background:rgba(232,200,74,.08); border:1px solid rgba(232,200,74,.3);
  color:var(--gold); font-size:.75rem; font-weight:700;
  letter-spacing:.05em; cursor:pointer; transition:all .15s; white-space:nowrap;
  font-family:'Noto Sans JP',sans-serif;
}
.search-btn:hover { background:rgba(232,200,74,.14); }
.search-btn:disabled { opacity:.35; cursor:not-allowed; }
.web-btn {
  padding:.75rem 1rem; border-radius:6px;
  background:rgba(58,240,224,.06); border:1px solid rgba(58,240,224,.25);
  color:var(--cyan); font-size:.7rem; font-weight:700;
  letter-spacing:.03em; cursor:pointer; transition:all .15s; white-space:nowrap;
  font-family:'Noto Sans JP',sans-serif; flex-shrink:0;
}
.web-btn:hover { background:rgba(58,240,224,.13); }
.web-btn:disabled { opacity:.35; cursor:not-allowed; }

.search-hint {
  margin-top:.5rem; min-height:1.2rem;
  font-size:.72rem; display:flex; align-items:center; gap:.4rem;
}
.hint-idle    { color:var(--muted); }
.hint-loading { color:var(--cyan); }
.hint-found   { color:var(--green); }
.hint-none    { color:var(--gold); }
.hint-err     { color:var(--red); }

@keyframes spin { to { transform:rotate(360deg); } }
.sp { display:inline-block; animation:spin .7s linear infinite; margin-right:.2rem; }

/* â”€â”€ Dropdown â”€â”€ */
.dropdown {
  position:absolute; top:calc(100% + .3rem); left:0; right:0;
  background:#18182c; border:1px solid var(--gold);
  border-radius:6px; z-index:200;
  box-shadow:0 16px 40px rgba(0,0,0,.7);
  animation:fadeIn .15s ease;
}
@keyframes fadeIn { from{opacity:0;transform:translateY(-4px)} to{opacity:1;transform:translateY(0)} }
.drop-item {
  display:flex; align-items:center;
  padding:.65rem .9rem; gap:.6rem;
  border-bottom:1px solid rgba(255,255,255,.04);
  transition:background .1s;
}
.drop-item:last-child { border-bottom:none; }
.drop-item:hover { background:rgba(232,200,74,.07); }
.drop-sel {
  flex:1; display:flex; align-items:center; gap:.6rem;
  cursor:pointer;
}
.drop-name { font-size:.85rem; flex:1; line-height:1.3; }
.drop-border {
  font-family:'Bebas Neue',sans-serif; font-size:1.05rem;
  color:var(--gold); letter-spacing:.05em; white-space:nowrap;
}
.drop-border span { font-size:.62rem; color:var(--muted); }
.drop-fav {
  background:none; border:none; cursor:pointer; font-size:1rem;
  padding:.1rem .3rem; border-radius:4px; flex-shrink:0;
  color:var(--dim); transition:transform .15s, color .15s;
}
.drop-fav:hover { transform:scale(1.3); color:var(--fav); }
.drop-fav.on { color:var(--fav); }

/* cache pills */
.cache-bar { display:flex; flex-wrap:wrap; gap:.4rem; margin-top:.6rem; }
.cache-pill {
  font-size:.62rem; padding:.15rem .6rem;
  background:rgba(58,240,224,.05); border:1px solid rgba(58,240,224,.15);
  border-radius:3px; color:var(--cyan); cursor:pointer; transition:background .1s;
}
.cache-pill:hover { background:rgba(58,240,224,.12); }

/* â”€â”€ Selected box â”€â”€ */
.sel-box {
  display:none; align-items:center; gap:.7rem;
  padding:.7rem 1rem; border-radius:6px; margin-bottom:1.2rem;
  background:rgba(58,240,224,.05); border:1px solid rgba(58,240,224,.2);
}
.sel-box.show { display:flex; }
.sel-info { flex:1; min-width:0; }
.sel-lbl { font-size:.6rem; color:var(--cyan); letter-spacing:.1em; margin-bottom:.2rem; }
.sel-nm { font-size:.9rem; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.sel-fav-btn {
  flex-shrink:0;
  background:none; border:1px solid rgba(255,154,0,.3);
  border-radius:5px; padding:.35rem .55rem;
  cursor:pointer; font-size:.75rem; transition:all .15s;
  color:var(--dim); white-space:nowrap; font-family:'Noto Sans JP',sans-serif;
}
.sel-fav-btn:hover { background:rgba(255,154,0,.1); color:var(--fav); border-color:var(--fav); }
.sel-fav-btn.on { color:var(--fav); border-color:var(--fav); background:rgba(255,154,0,.08); }
.sel-bdr { text-align:right; flex-shrink:0; }
.sel-bdr-lbl { font-size:.58rem; color:var(--muted); margin-bottom:.1rem; }
.sel-bdr-val { font-family:'Bebas Neue'; font-size:1.5rem; color:var(--gold); letter-spacing:.05em; }
.sel-bdr-unit { font-size:.56rem; color:var(--muted); }

/* â”€â”€ Inputs â”€â”€ */
.input-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-top:1.2rem; }
.field { display:flex; flex-direction:column; gap:.35rem; }
.field.span2 { grid-column:1/-1; }
.field-hd { display:flex; justify-content:space-between; align-items:center; }
.field label { font-size:.68rem; color:var(--muted); letter-spacing:.06em; }
.field label em { color:rgba(58,240,224,.6); font-style:normal; }
.num-input {
  background:rgba(0,0,0,.5); border:1px solid var(--dim);
  border-radius:6px; color:var(--text);
  font-family:'Noto Sans JP',sans-serif; font-size:1.1rem;
  padding:.7rem .9rem; outline:none; width:100%; transition:border-color .15s;
}
.num-input::placeholder { color:#20203a; }
.num-input:focus { border-color:var(--cyan); box-shadow:0 0 12px rgba(58,240,224,.08); }

/* å††/ç‰ toggle */
.unit-tgl { display:flex; border:1px solid var(--dim); border-radius:5px; overflow:hidden; }
.utgl-btn {
  padding:.18rem .55rem; font-size:.65rem; font-weight:700;
  border:none; cursor:pointer; transition:all .12s;
  background:transparent; color:var(--muted);
  font-family:'Noto Sans JP',sans-serif; letter-spacing:.04em;
}
.utgl-btn.on { background:var(--cyan); color:#000a; }

.invest-wrap { position:relative; }
.invest-sfx {
  position:absolute; right:.9rem; top:50%; transform:translateY(-50%);
  font-size:.8rem; color:var(--muted); pointer-events:none;
}
.conv-hint { font-size:.65rem; color:var(--muted); margin-top:.25rem; min-height:.9rem; }
.conv-hint.on { color:var(--cyan); }

/* â”€â”€ Calc btn â”€â”€ */
.calc-btn {
  width:100%; margin-top:1.4rem; padding:1rem;
  background:linear-gradient(135deg, rgba(232,200,74,.12), rgba(232,200,74,.05));
  border:1px solid var(--gold); border-radius:6px;
  color:var(--gold); font-family:'Bebas Neue',sans-serif;
  font-size:1.1rem; letter-spacing:.2em;
  cursor:pointer; transition:all .15s;
  text-shadow:0 0 20px rgba(232,200,74,.4);
}
.calc-btn:hover {
  background:linear-gradient(135deg, rgba(232,200,74,.2), rgba(232,200,74,.1));
  box-shadow:0 0 28px rgba(232,200,74,.15);
}

/* â”€â”€ Result â”€â”€ */
.result {
  display:none; background:var(--panel); border:1px solid var(--border);
  border-radius:8px; overflow:hidden; animation:fadeIn .3s ease; margin-top:1rem;
}
.result.show { display:block; }
.result-top { padding:1.5rem 1.8rem; border-bottom:1px solid var(--border); }
.result-top.pos { background:rgba(46,240,138,.04); border-bottom-color:rgba(46,240,138,.12); }
.result-top.neg { background:rgba(255,59,92,.04);  border-bottom-color:rgba(255,59,92,.12); }
.result-top.even{ background:rgba(232,200,74,.03); border-bottom-color:rgba(232,200,74,.1); }
.verdict-row { display:flex; align-items:flex-start; gap:1rem; }
.verdict-icon { font-size:2rem; line-height:1; flex-shrink:0; }
.verdict-title { font-size:1.05rem; font-weight:700; margin-bottom:.25rem; }
.verdict-title.pos  { color:var(--green); }
.verdict-title.neg  { color:var(--red); }
.verdict-title.even { color:var(--gold); }
.verdict-sub { font-size:.76rem; color:var(--muted); line-height:1.5; }

.nums-row {
  display:grid; grid-template-columns:1fr 1fr;
  gap:1px; background:var(--border); border-bottom:1px solid var(--border);
}
.num-cell { background:var(--panel2); padding:1rem 1.2rem; text-align:center; }
.num-cell-lbl { font-size:.58rem; letter-spacing:.1em; color:var(--muted); margin-bottom:.3rem; }
.num-big { font-family:'Bebas Neue',sans-serif; font-size:2.6rem; line-height:1; letter-spacing:.03em; }
.num-big.cyan { color:var(--cyan); text-shadow:0 0 20px rgba(58,240,224,.4); }
.num-big.gold { color:var(--gold); text-shadow:0 0 20px rgba(232,200,74,.4); }
.num-big.pos  { color:var(--green); text-shadow:0 0 20px rgba(46,240,138,.3); }
.num-big.neg  { color:var(--red);   text-shadow:0 0 20px rgba(255,59,92,.3); }
.num-unit { font-size:.62rem; color:var(--muted); margin-top:.1rem; }

.diff-area { padding:1.2rem 1.8rem; border-bottom:1px solid var(--border); }
.diff-hd { display:flex; justify-content:space-between; font-size:.68rem; color:var(--muted); margin-bottom:.5rem; }
.diff-hd strong { font-family:'Bebas Neue',sans-serif; font-size:.9rem; }
.diff-track { height:6px; background:rgba(255,255,255,.05); border-radius:3px; position:relative; overflow:hidden; }
.diff-mid { position:absolute; top:0; bottom:0; left:50%; width:1px; background:var(--dim); }
.diff-fill { position:absolute; top:0; bottom:0; border-radius:3px; transition:width .8s cubic-bezier(.34,1.56,.64,1); }

.detail-list { padding:1rem 1.8rem; display:flex; flex-direction:column; gap:.55rem; }
.d-row { display:flex; justify-content:space-between; font-size:.78rem; }
.d-key { color:var(--muted); }
.d-val { font-weight:700; font-family:'Bebas Neue',sans-serif; font-size:.95rem; letter-spacing:.05em; }
.note-box { margin:1rem 1.8rem 1.4rem; padding:.8rem 1rem; border-radius:5px; font-size:.74rem; line-height:1.6; }
.note-box.warn { background:rgba(232,200,74,.05); border:1px solid rgba(232,200,74,.2); color:var(--gold); }

@media(max-width:480px) {
  .input-grid { grid-template-columns:1fr; }
  .field.span2 { grid-column:1; }
  .nums-row { grid-template-columns:1fr 1fr; }
  .num-big { font-size:2rem; }
}

/* â”€â”€ Settings Modal â”€â”€ */
.modal-overlay {
  display:none; position:fixed; inset:0; z-index:9999;
  background:rgba(0,0,0,.85); align-items:center; justify-content:center;
  padding:1.2rem;
}
.modal-overlay.show { display:flex; }
.modal-box {
  background:#14142a; border:1px solid var(--gold);
  border-radius:10px; padding:1.8rem; width:100%; max-width:500px;
  box-shadow:0 0 60px rgba(232,200,74,.15);
}
.modal-title {
  font-family:'Bebas Neue',sans-serif; font-size:1.4rem;
  color:var(--gold); letter-spacing:.1em; margin-bottom:1rem;
}
.modal-desc { font-size:.8rem; color:var(--muted); line-height:1.7; margin-bottom:1.2rem; }
.modal-desc a { color:var(--cyan); }
.modal-input {
  width:100%; background:rgba(0,0,0,.5); border:1px solid var(--dim);
  border-radius:6px; color:var(--text); font-family:monospace;
  font-size:.9rem; padding:.75rem 1rem; outline:none;
  transition:border-color .15s; margin-bottom:.8rem;
}
.modal-input:focus { border-color:var(--gold); }
.modal-btns { display:flex; gap:.6rem; justify-content:flex-end; }
.modal-btn-save {
  padding:.65rem 1.4rem; border-radius:6px;
  background:rgba(232,200,74,.1); border:1px solid var(--gold);
  color:var(--gold); font-weight:700; font-size:.8rem;
  cursor:pointer; transition:all .15s; font-family:'Noto Sans JP',sans-serif;
}
.modal-btn-save:hover { background:rgba(232,200,74,.2); }
.modal-btn-cancel {
  padding:.65rem 1.2rem; border-radius:6px;
  background:transparent; border:1px solid var(--dim);
  color:var(--muted); font-size:.8rem;
  cursor:pointer; font-family:'Noto Sans JP',sans-serif;
}
/* settings button in header */
.settings-btn {
  position:fixed; bottom:1.2rem; right:1.2rem; z-index:500;
  background:rgba(10,10,15,.9); border:1px solid var(--dim);
  border-radius:50%; width:44px; height:44px;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:1.1rem; transition:border-color .15s;
  box-shadow:0 4px 20px rgba(0,0,0,.5);
}
.settings-btn:hover { border-color:var(--gold); }
/* hint bar */
.settings-hint {
  background:rgba(255,59,92,.08); border:1px solid rgba(255,59,92,.25);
  border-radius:6px; padding:.7rem 1rem; margin-bottom:1rem;
  font-size:.75rem; color:var(--red); display:flex;
  align-items:center; justify-content:space-between; gap:.8rem;
}
.settings-hint a { color:var(--gold); cursor:pointer; font-weight:700; }


/* â”€â”€ Settings Modal â”€â”€ */
.modal-overlay {
  display:none; position:fixed; inset:0; z-index:9999;
  background:rgba(0,0,0,.88); align-items:center; justify-content:center; padding:1.2rem;
}
.modal-overlay.open { display:flex; }
.modal-box {
  background:#14142a; border:1px solid var(--gold);
  border-radius:10px; padding:1.8rem; width:100%; max-width:500px;
  box-shadow:0 0 60px rgba(232,200,74,.15);
}
.modal-title { font-family:'Bebas Neue',sans-serif; font-size:1.4rem; color:var(--gold); letter-spacing:.1em; margin-bottom:1rem; }
.modal-desc { font-size:.8rem; color:var(--muted); line-height:1.7; margin-bottom:1.2rem; }
.modal-desc a { color:var(--cyan); }
.modal-input {
  width:100%; background:rgba(0,0,0,.5); border:1px solid var(--dim);
  border-radius:6px; color:var(--text); font-family:monospace;
  font-size:.9rem; padding:.75rem 1rem; outline:none; transition:border-color .15s; margin-bottom:.8rem;
}
.modal-input:focus { border-color:var(--gold); }
.modal-btns { display:flex; gap:.6rem; justify-content:flex-end; }
.mbtn-save {
  padding:.65rem 1.4rem; border-radius:6px;
  background:rgba(232,200,74,.1); border:1px solid var(--gold);
  color:var(--gold); font-weight:700; font-size:.8rem;
  cursor:pointer; transition:all .15s; font-family:'Noto Sans JP',sans-serif;
}
.mbtn-save:hover { background:rgba(232,200,74,.2); }
.mbtn-cancel {
  padding:.65rem 1.2rem; border-radius:6px;
  background:transparent; border:1px solid var(--dim);
  color:var(--muted); font-size:.8rem; cursor:pointer; font-family:'Noto Sans JP',sans-serif;
}
.settings-fab {
  position:fixed; bottom:1.2rem; right:1.2rem; z-index:500;
  background:rgba(10,10,15,.92); border:1px solid var(--dim);
  border-radius:50%; width:46px; height:46px;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:1.15rem; transition:border-color .15s;
  box-shadow:0 4px 20px rgba(0,0,0,.5);
}
.settings-fab:hover { border-color:var(--gold); }
.settings-hint {
  display:none; background:rgba(255,59,92,.08); border:1px solid rgba(255,59,92,.25);
  border-radius:6px; padding:.65rem 1rem; margin-bottom:.9rem;
  font-size:.75rem; color:var(--red);
  align-items:center; justify-content:space-between; gap:.8rem;
}
.settings-hint a { color:var(--gold); cursor:pointer; font-weight:700; text-decoration:none; }

</style>
</head>
<body>
<div class="wrap">

  <div class="hdr">
    <div class="hdr-sub">Pachinko Analytics</div>
    <h1>BORDER<br><span>CALCULATOR</span></h1>
    <div class="hdr-tags">
      <span class="tag gold">3.57å††æ›é‡‘ç‡</span>
      <span class="tag cyan">ğŸ¤– Gemini AI ç„¡æ–™æ¤œç´¢</span>
      <span class="tag fav">â˜… ãŠæ°—ã«å…¥ã‚Šå¯¾å¿œ</span>
      <span id="apiKeyStatus" onclick="openSettings()" style="cursor:pointer;" style="font-size:.62rem; padding:.2rem .65rem; border-radius:3px; letter-spacing:.03em; cursor:pointer;" onclick="openSettings()">âš™ APIã‚­ãƒ¼è¨­å®š</span>
    </div>
    <hr class="rule">
  </div>


  <div class="settings-hint" id="settingsHint" style="display:none;">
    âš  APIã‚­ãƒ¼ãŒæœªè¨­å®šã§ã™ã€‚æ¤œç´¢ã™ã‚‹ã«ã¯APIã‚­ãƒ¼ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚
    <a onclick="openSettings()">ä»Šã™ãè¨­å®š â†’</a>
  </div>

  <div class="settings-hint" id="settingsHint">âš  AIã‚­ãƒ¼æœªè¨­å®šã€‚DBã®ã¿åˆ©ç”¨ä¸­ã€‚ã€€<a onclick="openSettings()">ç„¡æ–™AIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦æ¤œç´¢ç²¾åº¦UP â†’</a></div>
  <!-- Step 1 -->
  <div class="card">
    <div class="card-label">Step 1 â€” æ©Ÿç¨®åã§æ¤œç´¢</div>

    <!-- Favorites -->
    <div id="favSection" style="display:none;">
      <div class="fav-section">
        <div class="fav-title">â˜… ãŠæ°—ã«å…¥ã‚Š</div>
        <div class="fav-list" id="favList"></div>
      </div>
      <div class="fav-divider"></div>
    </div>

    <!-- Search -->
    <div class="search-block">
      <div class="search-row">
        <input class="machine-input" id="machineInput"
          type="text" placeholder="æ©Ÿç¨®åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šåŒ—æ–—ã€ç‰™ç‹¼ã€ã‚¨ãƒ´ã‚¡ï¼‰"
          autocomplete="off" spellcheck="false">
        <button class="search-btn" id="searchBtn" onclick="doSearch()">æ¤œç´¢</button>
        <button class="web-btn" id="webBtn" onclick="doWebSearch()" title="æœ€æ–°æ©Ÿç¨®ã‚’WEBã‹ã‚‰æ¤œç´¢ï¼ˆã‚„ã‚„é…ã„ï¼‰">ğŸŒ æœ€æ–°</button>
      </div>
      <div class="search-hint" id="searchHint">
        <span class="hint-idle">æ©Ÿç¨®åã‚’å…¥åŠ›ã™ã‚‹ã¨æœ€æ–°ãƒœãƒ¼ãƒ€ãƒ¼ã‚’AIãŒè‡ªå‹•å–å¾—ã—ã¾ã™</span>
      </div>
      <div class="dropdown" id="dropdown" style="display:none;"></div>
    </div>

    <div id="cacheSection" style="display:none; margin-top:.9rem;">
      <div style="font-size:.6rem; color:var(--muted); letter-spacing:.1em; margin-bottom:.4rem;">â–¸ æœ€è¿‘ã®æ¤œç´¢</div>
      <div class="cache-bar" id="cachePills"></div>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="card">
    <div class="card-label">Step 2 â€” ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</div>

    <div class="sel-box" id="selBox">
      <div class="sel-info">
        <div class="sel-lbl">é¸æŠä¸­ã®æ©Ÿç¨®</div>
        <div class="sel-nm" id="selName">â€”</div>
      </div>
      <button class="sel-fav-btn" id="selFavBtn" onclick="toggleFavSelected()">â˜† ãŠæ°—ã«å…¥ã‚Š</button>
      <div class="sel-bdr">
        <div class="sel-bdr-lbl">ãƒœãƒ¼ãƒ€ãƒ¼ï¼ˆ3.57å††ï¼‰</div>
        <div class="sel-bdr-val" id="selBorder">â€”</div>
        <div class="sel-bdr-unit">å› / 1000å††</div>
      </div>
    </div>

    <div class="input-grid">
      <div class="field">
        <label>ã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã®å›è»¢æ•° <em>ï¼ˆå›ï¼‰</em></label>
        <input class="num-input" type="number" id="startRot" placeholder="0" min="0" value="0">
      </div>

      <div class="field">
        <div class="field-hd">
          <label id="investLbl">æŠ•è³‡é‡‘é¡ <em>ï¼ˆå††ï¼‰</em></label>
          <div class="unit-tgl">
            <button class="utgl-btn on" id="btnYen"  onclick="setUnit('yen')">å††</button>
            <button class="utgl-btn"    id="btnBall" onclick="setUnit('ball')">ç‰</button>
          </div>
        </div>
        <div class="invest-wrap">
          <input class="num-input" type="number" id="investment"
            placeholder="ä¾‹: 5000" min="0" step="500" oninput="onInvestInput()" style="padding-right:2.2rem;">
          <span class="invest-sfx" id="investSfx">å††</span>
        </div>
        <div class="conv-hint" id="convHint"></div>
      </div>

      <div class="field span2">
        <label>ç¾åœ¨ã®å›è»¢æ•° <em>ï¼ˆå›ï¼‰</em></label>
        <input class="num-input" type="number" id="currentRot" placeholder="ä¾‹: 250" min="0">
      </div>
    </div>

    <button class="calc-btn" onclick="calculate()">CALCULATE</button>
  </div>

  <!-- Result -->
  <div class="result" id="result">
    <div class="result-top" id="resultTop">
      <div class="verdict-row">
        <div class="verdict-icon" id="vIcon"></div>
        <div>
          <div class="verdict-title" id="vTitle"></div>
          <div class="verdict-sub"   id="vSub"></div>
        </div>
      </div>
    </div>
    <div class="nums-row">
      <div class="num-cell">
        <div class="num-cell-lbl">ç¾åœ¨ã®å›è»¢ç‡</div>
        <div class="num-big cyan" id="rRate">â€”</div>
        <div class="num-unit">å› / 1000å††</div>
      </div>
      <div class="num-cell">
        <div class="num-cell-lbl">ãƒœãƒ¼ãƒ€ãƒ¼ï¼ˆ3.57å††ï¼‰</div>
        <div class="num-big gold" id="rBorder">â€”</div>
        <div class="num-unit">å› / 1000å††</div>
      </div>
      <div class="num-cell">
        <div class="num-cell-lbl">ãƒœãƒ¼ãƒ€ãƒ¼ã¨ã®å·®</div>
        <div class="num-big" id="rDiff">â€”</div>
        <div class="num-unit">å›</div>
      </div>
      <div class="num-cell">
        <div class="num-cell-lbl">ç´”å›è»¢æ•°</div>
        <div class="num-big cyan" id="rNet">â€”</div>
        <div class="num-unit">å›ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆé™¤ãï¼‰</div>
      </div>
    </div>
    <div class="diff-area" id="diffArea" style="display:none;">
      <div class="diff-hd"><span>ãƒœãƒ¼ãƒ€ãƒ¼æ¯”è¼ƒ</span><strong id="diffLbl"></strong></div>
      <div class="diff-track">
        <div class="diff-mid"></div>
        <div class="diff-fill" id="diffFill"></div>
      </div>
    </div>
    <div class="detail-list">
      <div class="d-row"><span class="d-key">æŠ•è³‡é‡‘é¡ï¼ˆæ›ç®—å¾Œï¼‰</span><span class="d-val" id="rInvest">â€”</span></div>
      <div class="d-row"><span class="d-key">1000å††ã‚ãŸã‚Šå›è»¢æ•°</span><span class="d-val" id="rRate1k">â€”</span></div>
      <div class="d-row" id="rSrcRow" style="display:none;">
        <span class="d-key">ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</span>
        <span class="d-val" style="font-size:.7rem;font-family:'Noto Sans JP';color:var(--muted);" id="rSrc">â€”</span>
      </div>
    </div>
    <div class="note-box warn" id="noNote" style="display:none;">
      âš  ãƒœãƒ¼ãƒ€ãƒ¼ãŒå–å¾—ã§ããªã‹ã£ãŸãŸã‚å›è»¢ç‡ã®ã¿è¨ˆç®—ã—ã¾ã—ãŸã€‚æ©Ÿç¨®åã‚’å¤‰ãˆã¦å†æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
    </div>
  </div>

</div>
<script>

const STATIC_DB = [
  // â”€â”€ ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ â”€â”€
  {name:"eæ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ã€œã¯ã˜ã¾ã‚Šã®è¨˜æ†¶ã€œ", border:19.5, year:2024},
  {name:"Pã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ã€œè¶…è¦šé†’ã€œ", border:19.0, year:2023},
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼æ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ã€œæœªæ¥ã¸ã®å’†å“®ã€œ", border:18.5, year:2022},
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼æ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³15", border:19.2, year:2021},
  {name:"PAæ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ã€œæœªæ¥ã¸ã®å’†å“®ã€œSPECIAL", border:18.3, year:2020},
  {name:"Pæ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ã€œæœªæ¥ã¸ã®ç¿¼ã€œ", border:18.8, year:2019},
  // â”€â”€ åŒ—æ–—ã®æ‹³ â”€â”€
  {name:"eåŒ—æ–—ã®æ‹³11 æš´å‡¶æ˜Ÿ", border:17.5, year:2024},
  {name:"eåŒ—æ–—ã®æ‹³10 å¤¢å¹»é—˜ä¹±", border:18.2, year:2023},
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼åŒ—æ–—ã®æ‹³ã€œå¼·æ•µã€œ", border:17.8, year:2022},
  {name:"PAåŒ—æ–—ã®æ‹³8 æ•‘ä¸–ä¸»ä¼èª¬", border:16.9, year:2021},
  {name:"PåŒ—æ–—ã®æ‹³7 æ–°ä¼èª¬å‰µé€ ", border:17.1, year:2020},
  {name:"CRåŒ—æ–—ã®æ‹³6 æ‹³ç‹", border:16.5, year:2018},
  // â”€â”€ ç‰™ç‹¼ â”€â”€
  {name:"Pç‰™ç‹¼GOLD IMPACT", border:17.5, year:2023},
  {name:"Pç‰™ç‹¼ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ éŠã‚¿ã‚¤ãƒ ver.", border:48.2, year:2022},
  {name:"Pæ¿€ãƒ‡ã‚¸çœŸãƒ»ç‰™ç‹¼", border:17.8, year:2022},
  {name:"PAç‰™ç‹¼ã€œMAKAISENKIã€œ", border:18.1, year:2021},
  {name:"Pç‰™ç‹¼ã€œç…§é­”ã®åˆ»ã€œ", border:17.6, year:2020},
  {name:"CRç‰™ç‹¼ã€œé­”æˆ’ãƒèŠ±ã€œ", border:16.8, year:2018},
  // â”€â”€ æµ·ç‰©èª â”€â”€
  {name:"Pã‚¹ãƒ¼ãƒ‘ãƒ¼æµ·ç‰©èªINæ²–ç¸„5", border:19.8, year:2024},
  {name:"PAã‚¹ãƒ¼ãƒ‘ãƒ¼æµ·ç‰©èªINæ²–ç¸„4 æ¡œver.", border:18.9, year:2022},
  {name:"Pã‚¹ãƒ¼ãƒ‘ãƒ¼æµ·ç‰©èªINæ²–ç¸„4", border:18.5, year:2021},
  {name:"Pã‚¹ãƒ¼ãƒ‘ãƒ¼æµ·ç‰©èªIN JAPAN2", border:17.9, year:2020},
  {name:"PAã‚¹ãƒ¼ãƒ‘ãƒ¼æµ·ç‰©èªIN JAPAN2é‡‘å¯Œå£«99ver.", border:17.6, year:2020},
  {name:"CRå¤§æµ·ç‰©èª4", border:16.5, year:2017},
  // â”€â”€ æ°´æˆ¸é»„é–€ â”€â”€
  {name:"Pæ°´æˆ¸é»„é–€3", border:20.5, year:2024},
  {name:"Pæ°´æˆ¸é»„é–€2", border:19.8, year:2022},
  {name:"PAæ°´æˆ¸é»„é–€", border:18.9, year:2020},
  // â”€â”€ æš´ã‚Œã‚“åŠå°†è» â”€â”€
  {name:"Pæš´ã‚Œã‚“åŠå°†è»2", border:20.1, year:2024},
  {name:"Pæš´ã‚Œã‚“åŠå°†è»", border:19.3, year:2022},
  // â”€â”€ ãƒªãƒ³ã‚° â”€â”€
  {name:"Pãƒªãƒ³ã‚°ã€œå‘ªã„ã®7æ—¥é–“3ã€œ", border:18.7, year:2024},
  {name:"Pãƒªãƒ³ã‚°ã€œå‘ªã„ã®7æ—¥é–“2ã€œ", border:18.2, year:2022},
  {name:"PAãƒªãƒ³ã‚°ã€œå‘ªã„ã®7æ—¥é–“ã€œ", border:17.8, year:2020},
  // â”€â”€ ãƒã‚¸ãƒªã‚¹ã‚¯ â”€â”€
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼ãƒã‚¸ãƒªã‚¹ã‚¯S", border:19.2, year:2024},
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼ãƒã‚¸ãƒªã‚¹ã‚¯ã€œçµ†ã€œå¼", border:18.8, year:2023},
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼ãƒã‚¸ãƒªã‚¹ã‚¯ã€œçµ†ã€œ", border:18.1, year:2021},
  // â”€â”€ ãƒ«ãƒ‘ãƒ³ä¸‰ä¸– â”€â”€
  {name:"Pãƒ«ãƒ‘ãƒ³ä¸‰ä¸–ã€œGAME OF PANTHERã€œ", border:20.3, year:2024},
  {name:"Pãƒ«ãƒ‘ãƒ³ä¸‰ä¸–ã€œæ¶ˆã•ã‚ŒãŸãƒ«ãƒ‘ãƒ³ã€œ", border:19.6, year:2023},
  {name:"Pãƒ«ãƒ‘ãƒ³ä¸‰ä¸– YEARS LATER", border:18.9, year:2022},
  {name:"PAãƒ«ãƒ‘ãƒ³ä¸‰ä¸–ã€œå¤§æ³¥æ£’å›£ã€œ", border:18.3, year:2021},
  // â”€â”€ ä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼ â”€â”€
  {name:"Pä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼ BLACK SUN", border:18.8, year:2024},
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼ä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼è½ŸéŸ³", border:18.5, year:2023},
  {name:"Pä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼ã€œè½ŸéŸ³ã€œ", border:17.9, year:2022},
  // â”€â”€ æ©Ÿå‹•æˆ¦å£«ã‚¬ãƒ³ãƒ€ãƒ  â”€â”€
  {name:"Pæ©Ÿå‹•æˆ¦å£«ã‚¬ãƒ³ãƒ€ãƒ SEED FREEDOM", border:19.7, year:2024},
  {name:"Pæ©Ÿå‹•æˆ¦å£«ã‚¬ãƒ³ãƒ€ãƒ ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³", border:18.9, year:2023},
  {name:"PAãƒ•ã‚£ãƒ¼ãƒãƒ¼æ©Ÿå‹•æˆ¦å£«ã‚¬ãƒ³ãƒ€ãƒ ", border:18.2, year:2021},
  // â”€â”€ å†¬ã®ã‚½ãƒŠã‚¿ â”€â”€
  {name:"På†¬ã®ã‚½ãƒŠã‚¿ã€œå›ã‚’å¿˜ã‚Œãªã„ã€œFOREVER", border:21.3, year:2022},
  {name:"På†¬ã®ã‚½ãƒŠã‚¿ã€œå›ã‚’å¿˜ã‚Œãªã„ã€œ", border:20.1, year:2020},
  // â”€â”€ ã¾ã©ã‹â˜†ãƒã‚®ã‚« â”€â”€
  {name:"Pã¾ã©ã‹â˜†ãƒã‚®ã‚«4", border:19.3, year:2024},
  {name:"Pã¾ã©ã‹â˜†ãƒã‚®ã‚«3", border:18.8, year:2022},
  {name:"PAé­”æ³•å°‘å¥³ã¾ã©ã‹â˜†ãƒã‚®ã‚«2", border:18.1, year:2020},
  // â”€â”€ èŠ±ã®æ…¶æ¬¡ â”€â”€
  {name:"PèŠ±ã®æ…¶æ¬¡ã€œæ¥µã€œ", border:17.3, year:2024},
  {name:"PAèŠ±ã®æ…¶æ¬¡ã€œè“®ã€œ", border:17.1, year:2022},
  {name:"PèŠ±ã®æ…¶æ¬¡ã€œè“®ã€œ99version", border:47.6, year:2022},
  // â”€â”€ ã‚µãƒ³ãƒ€ãƒ¼Vãƒ©ã‚¤ãƒˆãƒ‹ãƒ³ã‚° â”€â”€
  {name:"Pã‚µãƒ³ãƒ€ãƒ¼ãƒ©ã‚¤ãƒˆãƒ‹ãƒ³ã‚°", border:18.9, year:2023},
  {name:"PAã‚µãƒ³ãƒ€ãƒ¼V2 ãƒ©ã‚¤ãƒˆãƒ‹ãƒ³ã‚°", border:18.3, year:2021},
  // â”€â”€ å¤§å·¥ã®æºã•ã‚“ â”€â”€
  {name:"På¤§å·¥ã®æºã•ã‚“è¶…éŸ‹é§„å¤©", border:20.8, year:2023},
  {name:"PAå¤§å·¥ã®æºã•ã‚“è¶…éŸ‹é§„å¤©", border:20.2, year:2021},
  // â”€â”€ å“²ä¹Ÿ â”€â”€
  {name:"På“²ä¹Ÿã€œå¤©é‹åœ°åŠ›ã€œ", border:19.5, year:2023},
  // â”€â”€ æŠ¼å¿ï¼ç•ªé•· â”€â”€
  {name:"PAæŠ¼å¿ï¼ç•ªé•·3", border:19.8, year:2022},
  // â”€â”€ ãƒ‰ãƒ©ãƒ æµ·ç‰©èª â”€â”€
  {name:"Pãƒ‰ãƒ©ãƒ æµ·ç‰©èª", border:20.1, year:2023},
  // â”€â”€ ã‚´ãƒ«ã‚´13 â”€â”€
  {name:"Pã‚´ãƒ«ã‚´13ã€œå¿…æ®ºã®ä¸€æ’ƒã€œ", border:18.7, year:2022},
  // â”€â”€ ç‚ç‚ãƒæ¶ˆé˜²éšŠ â”€â”€
  {name:"Pç‚ç‚ãƒæ¶ˆé˜²éšŠ", border:19.5, year:2023},
  // â”€â”€ äº¤éŸ¿è©©ç¯‡ã‚¨ã‚¦ãƒ¬ã‚«ã‚»ãƒ–ãƒ³ â”€â”€
  {name:"PAäº¤éŸ¿è©©ç¯‡ã‚¨ã‚¦ãƒ¬ã‚«ã‚»ãƒ–ãƒ³ã€œHI-EVOLUTION ZEROã€œ", border:18.6, year:2021},
  // â”€â”€ ãƒ–ãƒ©ãƒƒã‚¯ãƒ©ã‚°ãƒ¼ãƒ³ â”€â”€
  {name:"Pãƒ–ãƒ©ãƒƒã‚¯ãƒ©ã‚°ãƒ¼ãƒ³4", border:20.8, year:2024},
  {name:"Pãƒ–ãƒ©ãƒƒã‚¯ãƒ©ã‚°ãƒ¼ãƒ³3", border:19.5, year:2022},
  // â”€â”€ ã‚ã‚“ã‚ã‚“ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹ â”€â”€
  {name:"Pã‚ã‚“ã‚ã‚“ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹ç”˜ãƒ‡ã‚¸", border:26.5, year:2023},
  // â”€â”€ ã‚­ãƒ£ãƒƒãƒ„ã‚¢ã‚¤ â”€â”€
  {name:"PAã‚­ãƒ£ãƒƒãƒ„ã‚¢ã‚¤", border:19.2, year:2022},
  // â”€â”€ ã‚·ãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚¿ãƒ¼ â”€â”€
  {name:"Pã‚·ãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚¿ãƒ¼", border:19.8, year:2023},
  // â”€â”€ è–é—˜å£«æ˜ŸçŸ¢ â”€â”€
  {name:"Pè–é—˜å£«æ˜ŸçŸ¢ã€œæµ·çš‡è¦šé†’ã€œ", border:19.6, year:2022},
  // â”€â”€ ãƒ‰ãƒ©ã‚´ãƒ³ãƒœãƒ¼ãƒ« â”€â”€
  {name:"Pãƒ‰ãƒ©ã‚´ãƒ³ãƒœãƒ¼ãƒ«è¶…é¬¼èˆè¾»æ‚Ÿç©º", border:19.4, year:2023},
  // â”€â”€ ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹ â”€â”€
  {name:"Pãƒ•ã‚£ãƒ¼ãƒãƒ¼ONEPIECEã€œéº¦ã‚ã‚‰ã®ä¸€å‘³ã€œ", border:19.2, year:2022},
  // â”€â”€ å¤©é¾ â”€â”€
  {name:"På¤©é¾ã€œè‡³é«˜ã®æ±ºæˆ¦ã€œ", border:18.9, year:2022},
  // â”€â”€ å‹åˆ©ã®å¥³ç¥NIKKE â”€â”€
  {name:"På‹åˆ©ã®å¥³ç¥NIKKE", border:20.5, year:2024},
  // â”€â”€ å‘ªè¡“å»»æˆ¦ â”€â”€
  {name:"På‘ªè¡“å»»æˆ¦", border:20.2, year:2024},
  // â”€â”€ é¬¼æ»…ã®åˆƒ â”€â”€
  {name:"Pé¬¼æ»…ã®åˆƒ", border:20.8, year:2024},
  // â”€â”€ ã‚¹ãƒ©ãƒ ãƒ€ãƒ³ã‚¯ â”€â”€
  {name:"Pã‚¹ãƒ©ãƒ ãƒ€ãƒ³ã‚¯", border:19.6, year:2023},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  API KEY MANAGEMENT (Gemini)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getApiKey() {
  return localStorage.getItem('pachi_gemini_key') || '';
}
function saveApiKey(key) {
  localStorage.setItem('pachi_gemini_key', key.trim());
}
function openSettings() {
  document.getElementById('settingsModal').style.display = 'flex';
  document.getElementById('apiKeyInput').value = getApiKey();
  document.getElementById('apiKeyInput').focus();
}
function closeSettings() {
  document.getElementById('settingsModal').style.display = 'none';
}
function saveSettings() {
  const key = document.getElementById('apiKeyInput').value.trim();
  if (!key) { alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  saveApiKey(key);
  closeSettings();
  document.getElementById('settingsHint').style.display = 'none';
  updateKeyStatus();
}
function updateKeyStatus() {
  const el = document.getElementById('apiKeyStatus');
  if (!el) return;
  if (getApiKey()) {
    el.textContent = 'âœ… AIã‚­ãƒ¼è¨­å®šæ¸ˆã¿';
    el.style.color = 'var(--green)';
  } else {
    el.textContent = 'âš™ AIã‚­ãƒ¼æœªè¨­å®š';
    el.style.color = 'var(--red)';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATIC DB SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function searchStaticDB(q) {
  const kw = q.replace(/[ã€€\s]/g,'').toLowerCase()
    .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0))
    .replace(/[ã-ã‚“]/g, c => String.fromCharCode(c.charCodeAt(0) + 0x60));
  const hits = STATIC_DB.filter(m => {
    const n = m.name.replace(/[ã€€\s]/g,'').toLowerCase()
      .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0))
      .replace(/[ã-ã‚“]/g, c => String.fromCharCode(c.charCodeAt(0) + 0x60));
    return n.includes(kw) || kw.includes(n.slice(0, Math.min(4, n.length)));
  });
  return hits.sort((a,b) => (b.year||0) - (a.year||0));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GEMINI API SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function callGemini(q) {
  const key = getApiKey();
  if (!key) return null;
  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
  const prompt = `ã‚ãªãŸã¯ãƒ‘ãƒãƒ³ã‚³ã®ãƒœãƒ¼ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³å°‚é–€å®¶ã§ã™ã€‚
ã€Œ${q}ã€ã«ã¤ã„ã¦3.57å††æ›é‡‘ç‡ï¼ˆ28å€‹äº¤æ›ï¼‰ã®ãƒœãƒ¼ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³ã‚’ç­”ãˆã¦ãã ã•ã„ã€‚
ã‚·ãƒªãƒ¼ã‚ºåãªã‚‰æœ€æ–°ä½œã‹ã‚‰æœ€å¤§6æ©Ÿç¨®ã‚’å°å…¥ãŒæ–°ã—ã„é †ã§è¿”ã—ã¦ãã ã•ã„ã€‚
eã€‡ã€‡/Pã€‡ã€‡/PAã€‡ã€‡ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’æ­£ç¢ºã«ä»˜ã‘ã‚‹ã“ã¨ã€‚
ãƒœãƒ¼ãƒ€ãƒ¼ã¯1000å††ã‚ãŸã‚Šã®å›è»¢æ•°ï¼ˆå°æ•°ç‚¹1æ¡ï¼‰ã€‚
å¿…ãšã“ã®JSONã®ã¿è¿”ã™ï¼ˆèª¬æ˜ä¸è¦ï¼‰:
[{"name":"æ©Ÿç¨®å","border":æ•°å€¤,"year":å°å…¥è¥¿æš¦å¹´}]`;

  const res = await Promise.race([
    fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    }),
    new Promise((_, r) => setTimeout(() => r(new Error('TIMEOUT')), 20000))
  ]);
  if (!res.ok) throw new Error(`Gemini API ${res.status}`);
  const data = await res.json();
  const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || '';
  const m = text.match(/\[[\s\S]*?\]/);
  if (!m) return [];
  try {
    const arr = JSON.parse(m[0]);
    return arr.filter(x => x && x.name && parseFloat(x.border) > 0)
      .map(x => ({ name: x.name, border: parseFloat(x.border), year: parseInt(x.year)||0, src: 'AIæ¤œç´¢ï¼ˆGeminiï¼‰' }));
  } catch(_) { return []; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FAVORITES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let favorites = [];
async function loadFavs() {
  try {
    const r = await window.storage.get('pachi-favs');
    if (r && r.value) favorites = JSON.parse(r.value);
  } catch(_) {}
  renderFavs();
  updateKeyStatus();
  if (!getApiKey()) {
    const h = document.getElementById('settingsHint');
    if (h) h.style.display = 'flex';
  }
}
async function saveFavs() {
  try { await window.storage.set('pachi-favs', JSON.stringify(favorites)); } catch(_) {}
}
const isFav = name => favorites.some(f => f.name === name);
function renderFavs() {
  const sec  = document.getElementById('favSection');
  const list = document.getElementById('favList');
  if (!favorites.length) { sec.style.display = 'none'; return; }
  sec.style.display = 'block';
  list.innerHTML = favorites.map((f, i) => `
    <div class="fav-item" onclick="pickFav(${i})">
      <span class="fav-star">â˜…</span>
      <span class="fav-name">${f.name}</span>
      <span class="fav-bdr">${f.border.toFixed(1)}<em> å›/åƒå††</em></span>
      <button class="fav-del" title="å‰Šé™¤" onclick="delFav(event,${i})">âœ•</button>
    </div>`).join('');
}
function pickFav(i) {
  const f = favorites[i]; if (!f) return;
  selected = f;
  machineInput.value = f.name;
  hideDD(); showSel(f);
  setHint('found', `â˜… ã€Œ${f.name}ã€ã‚’ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰é¸æŠã—ã¾ã—ãŸ`);
  machineInput.className = 'machine-input found';
}
function delFav(e, i) {
  e.stopPropagation();
  favorites.splice(i, 1);
  saveFavs(); renderFavs();
  if (selected) updateSelFavBtn(selected.name);
  if (dropdown._items) showDD(dropdown._items);
}
function addFav(m) {
  if (isFav(m.name)) return;
  favorites.unshift({ name: m.name, border: m.border, src: m.src||'DB' });
  saveFavs(); renderFavs();
}
function toggleFavSelected() {
  if (!selected) return;
  if (isFav(selected.name)) {
    const idx = favorites.findIndex(f => f.name === selected.name);
    if (idx !== -1) favorites.splice(idx, 1);
    saveFavs(); renderFavs();
  } else { addFav(selected); }
  updateSelFavBtn(selected.name);
  if (dropdown._items) showDD(dropdown._items);
}
function updateSelFavBtn(name) {
  const btn = document.getElementById('selFavBtn');
  if (isFav(name)) { btn.textContent = 'â˜… ãŠæ°—ã«å…¥ã‚Šæ¸ˆã¿'; btn.classList.add('on'); }
  else { btn.textContent = 'â˜† ãŠæ°—ã«å…¥ã‚Š'; btn.classList.remove('on'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UNIT TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let investUnit = 'yen';
function setUnit(u) {
  investUnit = u;
  document.getElementById('btnYen') .classList.toggle('on', u === 'yen');
  document.getElementById('btnBall').classList.toggle('on', u === 'ball');
  document.getElementById('investLbl').innerHTML =
    u === 'yen' ? 'æŠ•è³‡é‡‘é¡ <em>ï¼ˆå††ï¼‰</em>' : 'æŠ•è³‡é‡‘é¡ <em>ï¼ˆç‰ï¼‰</em>';
  document.getElementById('investSfx').textContent = u === 'yen' ? 'å††' : 'ç‰';
  const inp = document.getElementById('investment');
  inp.placeholder = u === 'yen' ? 'ä¾‹: 5000' : 'ä¾‹: 1250';
  inp.step = u === 'yen' ? 500 : 250;
  onInvestInput();
}
function onInvestInput() {
  const v = parseFloat(document.getElementById('investment').value);
  const h = document.getElementById('convHint');
  if (!v || isNaN(v)) { h.textContent = ''; h.className = 'conv-hint'; return; }
  if (investUnit === 'ball') {
    h.textContent = `â†’ ${Math.round(v / 250 * 1000).toLocaleString()} å††ï¼ˆ250ç‰=1000å††æ›ç®—ï¼‰`;
    h.className = 'conv-hint on';
  } else {
    h.textContent = `â†’ ç´„ ${Math.round(v / 1000 * 250).toLocaleString()} ç‰`;
    h.className = 'conv-hint';
  }
}
function getYen() {
  const v = parseFloat(document.getElementById('investment').value);
  if (!v || v <= 0) return null;
  return investUnit === 'ball' ? (v / 250) * 1000 : v;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cache = {};
let selected = null;
const machineInput = document.getElementById('machineInput');
const searchBtn    = document.getElementById('searchBtn');
const dropdown     = document.getElementById('dropdown');
const searchHint   = document.getElementById('searchHint');
const cacheSection = document.getElementById('cacheSection');
const cachePillsEl = document.getElementById('cachePills');
dropdown._items    = null;
let debTimer = null;

machineInput.addEventListener('input', () => {
  selected = null; hideSel();
  clearTimeout(debTimer);
  const q = machineInput.value.trim();
  if (!q) { setHint('idle','æ©Ÿç¨®åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šåŒ—æ–—ã€ã‚¨ãƒ´ã‚¡ã€ç‰™ç‹¼ï¼‰'); hideDD(); return; }
  const k = nrm(q);
  if (cache[k]) { showDD(cache[k]); setHint('found',`âœ“ ${cache[k].length} ä»¶è¡¨ç¤ºä¸­`); return; }
  // ã™ãDBã‚’æ¤œç´¢
  const dbHits = searchStaticDB(q);
  if (dbHits.length) {
    showDD(dbHits.map(m => ({...m, src:'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹'})));
    setHint('found', `âœ“ DB: ${dbHits.length} ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
  } else {
    setHint('loading','<span class="sp">â†»</span> å…¥åŠ›å¾…æ©Ÿä¸­...');
  }
  debTimer = setTimeout(doSearch, 800);
});
machineInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') { clearTimeout(debTimer); doSearch(); }
});
document.addEventListener('click', e => {
  if (!e.target.closest('.search-block')) hideDD();
});
const nrm = s => s.trim().replace(/\s+/g,'');

async function doSearch() {
  const q = machineInput.value.trim(); if (!q) return;
  const k = nrm(q);
  if (cache[k]) { showDD(cache[k]); setHint('found',`âœ“ ${cache[k].length} ä»¶è¡¨ç¤ºä¸­`); return; }

  // ã¾ãšDBæ¤œç´¢
  const dbHits = searchStaticDB(q).map(m => ({...m, src:'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹'}));

  // APIã‚­ãƒ¼ã‚ã‚Œã°Geminiæ¤œç´¢
  if (getApiKey()) {
    setDisabled(true);
    machineInput.className = 'machine-input searching';
    setHint('loading', `<span class="sp">â†»</span> AIæ¤œç´¢ä¸­...`);
    try {
      const aiHits = await callGemini(q);
      if (aiHits && aiHits.length) {
        // DBã¨AIã‚’ãƒãƒ¼ã‚¸ã€AIå„ªå…ˆãƒ»é‡è¤‡æ’é™¤ãƒ»å¹´é †ã‚½ãƒ¼ãƒˆ
        const merged = [...aiHits];
        for (const d of dbHits) {
          if (!merged.find(m => nrm(m.name) === nrm(d.name))) merged.push(d);
        }
        merged.sort((a,b) => (b.year||0) - (a.year||0));
        cache[k] = merged;
        showDD(merged);
        machineInput.className = 'machine-input found';
        setHint('found', `âœ“ AI+DB: ${merged.length} ä»¶ï¼ˆæœ€æ–°é †ï¼‰`);
        refreshCache();
        setDisabled(false);
        return;
      }
    } catch(err) {
      // AIå¤±æ•—æ™‚ã¯DBã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    }
    setDisabled(false);
  }

  // DBã®ã¿
  if (dbHits.length) {
    cache[k] = dbHits;
    showDD(dbHits);
    machineInput.className = 'machine-input found';
    setHint('found', `âœ“ DB: ${dbHits.length} ä»¶ï¼ˆAIã‚­ãƒ¼è¨­å®šã§ã•ã‚‰ã«æ¤œç´¢ç²¾åº¦UPï¼‰`);
    refreshCache();
  } else {
    machineInput.className = 'machine-input error';
    setHint('none', `âš  ã€Œ${q}ã€ã¯DBã«ã‚ã‚Šã¾ã›ã‚“ã€‚ğŸŒæœ€æ–°ãƒœã‚¿ãƒ³ã‹AIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚`);
    hideDD();
  }
}

async function doWebSearch() {
  const q = machineInput.value.trim(); if (!q) return;
  if (!getApiKey()) { openSettings(); return; }
  const k = nrm(q) + '_web';
  if (cache[k]) { showDD(cache[k]); setHint('found',`âœ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ${cache[k].length} ä»¶`); return; }

  setDisabled(true);
  machineInput.className = 'machine-input searching';
  setHint('loading', `<span class="sp">â†»</span> AIæœ€æ–°æ¤œç´¢ä¸­ï¼ˆæ•°ç§’ï¼‰...`);
  hideDD();
  try {
    const items = await callGemini(q + ' æœ€æ–° ç¾è¡Œæ©Ÿç¨® 2024 2025');
    if (items && items.length) {
      items.sort((a,b) => (b.year||0) - (a.year||0));
      cache[k] = items;
      cache[nrm(q)] = items;
      showDD(items);
      machineInput.className = 'machine-input found';
      setHint('found', `âœ“ AI: ${items.length} ä»¶ï¼ˆæœ€æ–°é †ï¼‰`);
      refreshCache();
    } else {
      machineInput.className = 'machine-input error';
      setHint('none', `âš  ã€Œ${q}ã€ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`);
      hideDD();
    }
  } catch(err) {
    machineInput.className = 'machine-input error';
    setHint('err', err.message === 'TIMEOUT' ? 'âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ' : `âŒ ${err.message}`);
  }
  setDisabled(false);
}

function showDD(items) {
  dropdown.innerHTML = items.map((m,i) => {
    const on = isFav(m.name);
    const badge = m.src === 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹' ? '<span style="font-size:.55rem;color:var(--muted);margin-left:.3rem;">DB</span>' : '<span style="font-size:.55rem;color:var(--cyan);margin-left:.3rem;">AI</span>';
    return `<div class="drop-item">
      <div class="drop-sel" onclick="pickDrop(${i})">
        <span class="drop-name">${m.name}${badge}</span>
        <span class="drop-border">${m.border.toFixed(1)}<span> å›/åƒå††</span></span>
      </div>
      <button class="drop-fav ${on?'on':''}" onclick="toggleFavDrop(${i},this)">${on?'â˜…':'â˜†'}</button>
    </div>`;
  }).join('');
  dropdown._items = items;
  dropdown.style.display = 'block';
}
function toggleFavDrop(i, btn) {
  const m = dropdown._items[i]; if(!m) return;
  if (isFav(m.name)) {
    const idx = favorites.findIndex(f=>f.name===m.name);
    if(idx!==-1) favorites.splice(idx,1);
    btn.textContent='â˜†'; btn.classList.remove('on');
  } else {
    addFav(m); btn.textContent='â˜…'; btn.classList.add('on');
  }
  saveFavs(); renderFavs();
  if(selected && selected.name===m.name) updateSelFavBtn(selected.name);
}
function pickDrop(i) {
  const items = dropdown._items; if(!items||!items[i]) return;
  const m = items[i];
  selected = m; machineInput.value = m.name;
  hideDD(); showSel(m);
  setHint('found', `âœ“ ã€Œ${m.name}ã€ãƒœãƒ¼ãƒ€ãƒ¼ ${m.border.toFixed(1)} å›`);
  machineInput.className = 'machine-input found';
}
function hideDD() { dropdown.style.display='none'; }
function showSel(m) {
  document.getElementById('selName').textContent = m.name;
  document.getElementById('selBorder').textContent = m.border.toFixed(1);
  document.getElementById('selBox').classList.add('show');
  updateSelFavBtn(m.name);
}
function hideSel() { document.getElementById('selBox').classList.remove('show'); }
function setHint(type, html) {
  searchHint.innerHTML = `<span class="hint-${type}">${html}</span>`;
}
function refreshCache() {
  const keys = Object.keys(cache).filter(k=>!k.endsWith('_web'));
  const sec = document.getElementById('cacheSection');
  if (!keys.length) { sec.style.display='none'; return; }
  sec.style.display='block';
  cachePillsEl.innerHTML = keys.slice(-5).map(k=>
    `<span class="cache-pill" onclick="loadCacheItem('${k}')">${(cache[k][0]?.name||k).slice(0,10)}â€¦ (${cache[k].length}ä»¶)</span>`
  ).join('');
}
function loadCacheItem(key) {
  if(!cache[key]) return;
  machineInput.value = cache[key][0].name;
  showDD(cache[key]);
  setHint('found',`âœ“ ${cache[key].length} ä»¶`);
  machineInput.className = 'machine-input found';
}
function setDisabled(v) {
  document.getElementById('searchBtn').disabled = v;
  document.getElementById('webBtn').disabled = v;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CALCULATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calculate() {
  const startRot  = parseFloat(document.getElementById('startRot').value) || 0;
  const investYen = getYen();
  const curRot    = parseFloat(document.getElementById('currentRot').value);
  const rawInvest = parseFloat(document.getElementById('investment').value);
  if (!investYen) { alert('æŠ•è³‡é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  if (isNaN(curRot)) { alert('ç¾åœ¨ã®å›è»¢æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  const net = curRot - startRot;
  if (net < 0) { alert('ç¾åœ¨ã®å›è»¢æ•°ãŒã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã‚ˆã‚Šå°ã•ã„ã§ã™'); return; }
  const rate = (net / investYen) * 1000;
  document.getElementById('rRate').textContent   = rate.toFixed(1);
  document.getElementById('rNet').textContent    = net.toLocaleString();
  document.getElementById('rRate1k').textContent = rate.toFixed(2) + ' å›';
  const investDisp = investUnit === 'ball'
    ? `${rawInvest.toLocaleString()} ç‰ (${Math.round(investYen).toLocaleString()} å††)`
    : `${Math.round(investYen).toLocaleString()} å††`;
  document.getElementById('rInvest').textContent = investDisp;
  const result = document.getElementById('result');
  const rtop   = document.getElementById('resultTop');
  const diffA  = document.getElementById('diffArea');
  const noNote = document.getElementById('noNote');
  const srcRow = document.getElementById('rSrcRow');
  if (selected && selected.border) {
    document.getElementById('rBorder').textContent = selected.border.toFixed(1);
    const diff = rate - selected.border;
    const sign = diff >= 0 ? '+' : '';
    const dEl  = document.getElementById('rDiff');
    dEl.textContent = `${sign}${diff.toFixed(1)}`;
    let cls, icon, title, sub;
    if      (diff >  3)   { cls='pos'; icon='ğŸ¯'; title=`ãƒœãƒ¼ãƒ€ãƒ¼å¤§å¹…è¶…ãˆï¼ ${sign}${diff.toFixed(1)} å›`; sub='å›è»¢ç‡ãŒå„ªç§€ã§ã™ã€‚ã“ã®ã¾ã¾ç¶šè¡ŒãŒæœŸå¾…å€¤ãƒ—ãƒ©ã‚¹ã§ã™ã€‚'; }
    else if (diff >  0.5) { cls='pos'; icon='âœ…'; title=`ãƒœãƒ¼ãƒ€ãƒ¼è¶…ãˆ  ${sign}${diff.toFixed(1)} å›`; sub='ãƒœãƒ¼ãƒ€ãƒ¼ã‚’ä¸Šå›ã£ã¦ã„ã¾ã™ã€‚ç¶šè¡Œæ¨å¥¨ã§ã™ã€‚'; }
    else if (diff >= -0.5){ cls='even';icon='âš–ï¸'; title=`ã»ã¼ãƒœãƒ¼ãƒ€ãƒ¼ï¼ˆ${sign}${diff.toFixed(1)} å›ï¼‰`; sub='æç›Šåˆ†å²ç‚¹ã«è¿‘ã„çŠ¶æ…‹ã§ã™ã€‚æ§˜å­ã‚’è¦‹ãªãŒã‚‰åˆ¤æ–­ã‚’ã€‚'; }
    else if (diff >  -3)  { cls='neg'; icon='âš ï¸'; title=`ãƒœãƒ¼ãƒ€ãƒ¼å‰²ã‚Œ  ${diff.toFixed(1)} å›`; sub='å›è»¢ç‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚å°ç§»å‹•ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚'; }
    else                  { cls='neg'; icon='ğŸš¨'; title=`å¤§å¹…ãƒœãƒ¼ãƒ€ãƒ¼å‰²ã‚Œ  ${diff.toFixed(1)} å›`; sub='ã‹ãªã‚Šä¸åˆ©ãªçŠ¶æ…‹ã§ã™ã€‚æ’¤é€€ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚'; }
    rtop.className=`result-top ${cls}`;
    dEl.className=`num-big ${cls}`;
    document.getElementById('vIcon').textContent=icon;
    document.getElementById('vTitle').className=`verdict-title ${cls}`;
    document.getElementById('vTitle').textContent=title;
    document.getElementById('vSub').textContent=sub;
    diffA.style.display='block';
    const pct=Math.min(Math.abs(diff)/selected.border*100,48);
    const fill=document.getElementById('diffFill');
    document.getElementById('diffLbl').textContent=`${sign}${diff.toFixed(1)} å›`;
    if(diff>=0){ fill.style.cssText=`left:50%;right:auto;width:${pct}%;background:linear-gradient(90deg,#2ef08a,#1ab060)`; }
    else       { fill.style.cssText=`right:50%;left:auto;width:${pct}%;background:linear-gradient(270deg,#ff3b5c,#cc2040)`; }
    srcRow.style.display='flex';
    document.getElementById('rSrc').textContent=selected.src||'DB';
    noNote.style.display='none';
  } else {
    document.getElementById('rBorder').textContent='â€”';
    const dEl=document.getElementById('rDiff'); dEl.textContent='â€”'; dEl.className='num-big gold';
    rtop.className='result-top even';
    document.getElementById('vIcon').textContent='ğŸ“Š';
    document.getElementById('vTitle').className='verdict-title even';
    document.getElementById('vTitle').textContent=`å›è»¢ç‡ ${rate.toFixed(2)} å› / 1000å††`;
    document.getElementById('vSub').textContent='æ©Ÿç¨®æœªé¸æŠã®ãŸã‚ãƒœãƒ¼ãƒ€ãƒ¼ã¨ã®æ¯”è¼ƒãŒã§ãã¾ã›ã‚“ã€‚å…ˆã«æ©Ÿç¨®ã‚’æ¤œç´¢ãƒ»é¸æŠã—ã¦ãã ã•ã„ã€‚';
    diffA.style.display='none'; srcRow.style.display='none'; noNote.style.display='block';
  }
  result.className='result show';
  result.scrollIntoView({behavior:'smooth',block:'nearest'});
}

// â”€â”€ init â”€â”€
loadFavs();

</script>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal" onclick="if(event.target===this)closeSettings()">
    <div class="modal-box">
      <div class="modal-title">âš™ APIã‚­ãƒ¼è¨­å®š</div>
      <div class="modal-desc">
        AIæ¤œç´¢ã‚’ä½¿ã†ã«ã¯ <a href="https://console.anthropic.com/settings/keys" target="_blank">Anthropic Console</a>
        ã§APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
        ç„¡æ–™ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚ã‚Šã€‚æ¤œç´¢1å›ã‚ãŸã‚Šç´„0.001ã€œ0.01å††ã€‚<br><br>
        âš  ã‚­ãƒ¼ã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ï¼‰ã€‚
      </div>
      <input class="modal-input" id="apiKeyInput" type="password"
        placeholder="sk-ant-api03-..." autocomplete="off" spellcheck="false"
        onkeydown="if(event.key==='Enter')saveSettings()">
      <div class="modal-btns">
        <button class="modal-btn-cancel" onclick="closeSettings()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="modal-btn-save" onclick="saveSettings()">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- Floating settings button -->
  <button class="settings-btn" onclick="openSettings()" title="APIã‚­ãƒ¼è¨­å®š">âš™</button>


  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal" onclick="if(event.target===this)closeSettings()">
    <div class="modal-box">
      <div class="modal-title">âš™ Gemini APIã‚­ãƒ¼è¨­å®š</div>
      <div class="modal-desc">
        AIæ¤œç´¢ï¼ˆå®Œå…¨ç„¡æ–™ï¼‰ã‚’ä½¿ã†ã«ã¯
        <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>
        ã§APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br><br>
        âœ… <strong>å®Œå…¨ç„¡æ–™</strong>ï¼ˆã‚¯ãƒ¬ã‚«ä¸è¦ãƒ»ç„¡æ–™æ 1æ—¥1500å›ï¼‰<br>
        âœ… ã‚­ãƒ¼ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ã«ä¿å­˜ï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—ï¼‰<br>
        âœ… DBã«ãªã„æœ€æ–°æ©Ÿç¨®ã‚‚AIã§æ¤œç´¢ã§ãã¾ã™
      </div>
      <input class="modal-input" id="apiKeyInput" type="password"
        placeholder="AIza..." autocomplete="off" spellcheck="false"
        onkeydown="if(event.key==='Enter')saveSettings()">
      <div class="modal-btns">
        <button class="mbtn-cancel" onclick="closeSettings()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="mbtn-save" onclick="saveSettings()">ä¿å­˜</button>
      </div>
    </div>
  </div>
  <button class="settings-fab" onclick="openSettings()" title="Gemini APIã‚­ãƒ¼è¨­å®š">âš™</button>

</body>
</html>
